!function(tactic){tactic.utils=tactic.utilities||tactic.utils||{},tactic.builder={props:{},layers:{}};var container=tactic.container,utils=tactic.utils;utils.arrayIndex=function(t,e){if(!utils.isArray(t))return-1;if(!utils.isString(e)&&!utils.isBoolean(e))return-1;if(Array.prototype.indexOf)return t.indexOf(e);for(var s=t.length;s--;)if(t[s]===e)return s;return-1},utils.getElementsByKey=function(t,e){return utils.isElement(t)?t.querySelectorAll("[data-key="+e+"]"):[]},utils.isTypeOf=function(t,e,s){return!utils.isFunction(t)||utils.isUndefined(e)?!utils.isUndefined(s)&&s:utils.isUndefined(s)?t(e):t(e)?e:s},utils.addEventSimple=function(t,e,s){return t&&e&&s?(t.addEventListener?t.addEventListener(e,s,!1):t.attachEvent&&t.attachEvent("on"+e,s),{target:t,type:e,callback:s}):null},utils.removeEventSimple=function(t,e,s){return t&&e&&s?(t.removeEventListener?t.removeEventListener(e,s,!1):t.detachEvent&&t.detachEvent("on"+e,s),null):{target:t,type:e,callback:s}},utils.getStyle=function(t,e,s){try{if(utils.isElement(t))return t.currentStyle?t.currentStyle[e]:document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t,"")[e]:t.style[e]}catch(t){}return s},utils.getAssetSource=function(t,e,s){var i={};if(t){t.sort(function(t,e){return t.width<e.width?1:t.width>e.width?-1:0}),i=t[0];for(var r=0;r<t.length&&!(e>=t[r].width||s>=t[r].height);r++)i=t[r]}return i},utils.getAssetUrl=function(t,e){utils.isString(e)||(e="url");var s=utils.isObject(t)?utils.isString(t[e])?t[e]:"":utils.isString(t)?t:"",i=!!s&&!(-1===s.indexOf("data:image"));return""===s||-1!==s.indexOf("http")||i||"//"===s.slice(0,2)||(s=tactic.url.package+"/"+s),i?s:tactic.url.sanitize(s)},utils.selectProperty=function(t,e){try{return t.filter(function(t){return t[0]<=e}).sort(function(t,e){return t[0]<e[0]?1:t[0]>e[0]?-1:0})[0][1]}catch(t){return null}},utils.watchFont=function(e,s,i,r){var a,o,n,l=(new Date).getTime(),u=document.createElement("span");function p(t){clearInterval(a);try{s.removeChild(u)}catch(t){}return utils.isFunction(i)&&i(e,t),!0}s=utils.isElement(s)?s:document.body;try{var t=u.style;t.fontFamily="Times New Roman",t.position="absolute",t.width="auto",t.height="auto",t.display="block",t.visibility="hidden",t.fontSize="48px",t.lineHeight="normal",u.innerHTML="QW@HhsXJ1",s.appendChild(u),setTimeout(function(){o=u.offsetWidth,n=u.offsetHeight,t.fontFamily=utils.isEmptyString(e)?"":e,function t(){return(new Date).getTime()-l>(utils.isNumber(r)?r:1e3)?p(!1):o!==u.offsetWidth||n!==u.offsetHeight?p(!0):(setTimeout(function(){t()},0),!1)}()},0)}catch(t){p(!1)}},utils.hasClass=function(t,e){return!utils.isUndefined(t)&&"className"in t&&new RegExp("(\\s|^)"+utils.escapeRegExpString(e)+"(\\s|$)").test(t.className)},utils.addClass=function(t,e){return utils.isElement(t)&&utils.isString(e)&&!utils.hasClass(t,e)&&(t.className+=" "+e,t.className=t.className.split("  ").join(" ").replace(/^\s+|\s+$/g,"")),utils.isString(e)?e:""},utils.addClasses=function(t,e){var s=[];if(utils.isElement(t)&&utils.isArray(e))for(var i in e)s.push(utils.addClass(t,e[i]));return s},utils.removeClass=function(t,e){return utils.isElement(t)&&utils.isString(e)&&utils.hasClass(t,e)&&(t.className=t.className.split("  ").join(" ").replace(new RegExp("(\\s|^)"+e+"(\\s|$)")," ")),utils.isString(e)?e:""},utils.removeClasses=function(t,e){var s=[];if(utils.isElement(t)&&utils.isArray(e))for(var i=0;i<e.length;i++)s.push(utils.removeClass(t,e[i]));return s},utils.getStyle=function(t,e,s){try{if(utils.isElement(t))return t.currentStyle?t.currentStyle[e]:document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t,"")[e]:t.style[e]}catch(t){}return s},utils.createCssRule=function(t,e){if(document.styleSheets&&0!==document.getElementsByTagName("head").length&&!utils.isEmptyString(t)&&"."!==t&&!utils.isEmptyString(e)){var s,i,r,a;if(t=1<(t=t.split(" !.").join(".")).split("!").length?t.split("!")[1]:t,e=e.split("'").join('"'),0<document.styleSheets.length)for(a=0,r=document.styleSheets.length;a<r;a++)if(!document.styleSheets[a].disabled){var o=document.styleSheets[a].media;if("string"===(i=typeof o)?""!==o&&-1===o.indexOf("screen")||(s=document.styleSheets[a]):"object"===i&&-1!==o.mediaText.indexOf("screen")&&(s=document.styleSheets[a]),void 0!==s)break}if(void 0===s){var n=document.createElement("style");for(n.type="text/css",document.getElementsByTagName("head")[0].appendChild(n),a=0;a<document.styleSheets.length;a++)document.styleSheets[a].disabled||(s=document.styleSheets[a]);i=typeof s.media}if("string"===i){for(a=0,r=s.rules.length;a<r;a++)if(s.rules[a].selectorText&&s.rules[a].selectorText.toLowerCase()===t.toLowerCase())return s.rules[a].style.cssText=e,{sheet:s,rule:a};return{sheet:s,rule:s.addRule(t,e)}}if("object"!==i)return null;var l=s.cssRules?s.cssRules.length:0;for(a=0;a<l;a++)if(s.cssRules[a].selectorText&&s.cssRules[a].selectorText.toLowerCase()===t.toLowerCase())return s.cssRules[a].style.cssText=e,{sheet:s,rule:a};return{sheet:s,rule:s.insertRule(t+"{"+e+"}",l)}}},utils.deleteCssRule=function(t,e){if(t){try{t.deleteRule?t.deleteRule(e):t.removeRule&&t.removeRule(e)}catch(t){return!1}return!0}return!1},utils.createCssString=function(t){var e="";if(utils.isObject(t))for(var s in t)if(t.hasOwnProperty(s)){var i=t[s];(utils.isString(i)||utils.isNumber(i))&&(-1!==s.indexOf("url")&&(i=utils.getAssetUrl(i)),e=e+(s+":")+(""===i?'""':i)+";")}return e},utils.createCssFontString=function(t){var e="";if(utils.isObject(t))for(var s in t)if(t.hasOwnProperty(s)){var i=t[s];if("src"===s){for(var r in i)if(i.hasOwnProperty(r)&&0<i[r].length){for(var a in e+="src: ",i[r])if(i[r].hasOwnProperty(a)){var o=i[r][a].url,n=i[r][a].format;o&&(e=e+'url("'+utils.getAssetUrl(o)+'")',n&&(e=e+' format("'+n+'")'),a<i[r].length-1&&(e+=","))}e+=";"}}else e="font-family"===s?e+s+':"'+i+'";':e+s+":"+i+";"}return e},utils.mergeObjects=function(e,s,t,i){var r=utils.isObject,a=utils.isBoolean,o=utils.isArray,n=utils.mergeArrays,l=utils.mergeObjects;for(var u in s)if(s.hasOwnProperty(u))try{o(s[u])&&a(t)&&t?e[u]=n(e[u],s[u]):!0===i||o(s[u])&&o(i)&&utils.arrayContains(i,u)?e[u]=s[u]:r(s[u])?e[u]=l(e[u],s[u],t):e[u]=s[u]}catch(t){e[u]=s[u]}return e},utils.extractExceptions=function(t,e,s,i,r,a,o){e=utils.isArray(e)?e:[],o=utils.isString(o)?o:"excepts",a=utils.isNumber(a)?a:999,s=utils.isArray(s)?s:[],i=!!utils.isBoolean(i)&&i,r=!utils.isArray(r)&&!utils.isBoolean(r)||r;try{if(utils.isObject(t)){for(var n in t)if(n===o)for(var l in t[n])t[n].hasOwnProperty(l)&&utils.arrayContains(e,l)&&0<a&&!utils.arrayContains(s,n)&&(utils.isObject(t[n][l])?t[n]=utils.mergeObjects(t,utils.extractExceptions(t[n][l],e,s,i,r,a-1,o),i,r):t[n]=t[n][l]);else utils.isObject(t[n])&&0<a&&!utils.arrayContains(s,n)&&(t[n]=utils.extractExceptions(t[n],e,s,i,r,a-1,o));t[o]&&delete t[o]}}catch(t){}return t},utils.wrapElement=function(t){var e=null,s=null;if(utils.isArray(t)&&0<t.length)for(var i=0;i<t.length;i++)if(!utils.isEmptyString(t[i])){var r=document.createElement(t[i]);utils.isElement(s)?(s.appendChild(r),s=r):utils.isElement(e)?(e.appendChild(r),s=r):e=s=r}return{initial:e,latest:s}},utils.replaceMacros=function(t,i,e,s,r){if(utils.isArray(i)){var a={};for(var o in i)a=utils.mergeObjects(a,utils.cloneObject(i[o]));i=a}function n(t,e){try{for(var s in i)t=t.toString().split("{"+s+"}").join(i[s]),e||("true"===t&&(t=!0),"false"===t&&(t=!1),"null"===t&&(t=null))}catch(t){}return t}e=utils.isArray(e)?e:[],s=!utils.isBoolean(s)||s,r=utils.isNumber(r)?r:999;try{if(utils.isString(t))t=n(t);else if(utils.isObject(t))for(var l in t)if(t.hasOwnProperty(l))if(utils.isString(t[l])){t[l]=n(t[l]);for(var u,p=t[l],c=0;c<10&&(utils.isString(t[l])&&p!==u&&-1!==t[l].indexOf("{")&&-1!==t[l].indexOf("}"));c++)t[l]=n(t[l]),u=t[l]}else{var y;if(0<r&&!utils.arrayContains(e,l)&&(t[l]=utils.replaceMacros(t[l],i,e,s,r-1)),s)l&&-1!==l.indexOf("{")&&-1!==l.indexOf("}")&&(y=n(l,!0)),y&&y!==l&&(t[y]=utils.cloneObject(t[l]),delete t[l])}}catch(t){}return t},utils.setAttribute=function(t,e,s,i){if(t){var r=[""].concat(i||[]);for(var a in r)try{t.setAttribute(r[a]+e,s)}catch(t){}}},utils.removeAttribute=function(t,e,s){if(t){var i=[""].concat(s||[]);for(var r in i)try{t.removeAttribute(i[r]+e)}catch(t){}}},utils.CSVToArray=function(t,e){e=e||",";for(var s=new RegExp("(\\"+e+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+e+"\\r\\n]*))","gi"),i=[[]],r=null;r=s.exec(t);){var a,o=r[1];o.length&&o!==e&&i.push([]),a=r[2]?r[2].replace(new RegExp('""',"g"),'"'):r[3],i[i.length-1].push(a)}return i},utils.DragWatcher=function(t,e,s){this.target=utils.isTypeOf(utils.isElement,t,t===document?document:null),this.callback=utils.isTypeOf(utils.isFunction,e,null),this.params={prevent:utils.isTypeOf(utils.isBoolean,utils.getObjectDeep(s,"prevent"),!0),delay:utils.isTypeOf(utils.isNumber,utils.getObjectDeep(s,"delay"),0)},this.startEvent=null;function i(t,e){o.callback(t,e,o.startEvent)}function r(t){i("click",t)}function a(t){if((t=t||window.event).changedTouches&&(t=t.changedTouches[0]),o.startEvent=t,n(o.target,"mousemove",u),n(o.target,"touchmove",u),n(o.target,"mouseup",p),n(o.target,"mouseout",p),n(o.target,"touchend",p),n(o.target,"touchcancel",p),n(o.target,"click",r),i("start",t),o.params.prevent)return!1}var o=this,n=utils.addEventSimple,l=utils.removeEventSimple,u=function(t){if(l(o.target,"click",r),i("move",t),o.params.prevent)return!1},p=function(t){if(l(o.target,"mousemove",u),l(o.target,"touchmove",u),l(o.target,"mouseup",p),l(o.target,"mouseout",p),l(o.target,"touchend",p),l(o.target,"touchcancel",p),i("stop",t),o.params.prevent)return!1};o.target&&o.callback&&(n(o.target,"mousedown",a),n(o.target,"touchstart",a))};var props=tactic.builder.props;props.AbstractProp=function(){this.type="AbstractProp"},props.AbstractProp.prototype.set=function(t){this.data=utils.isTypeOf(utils.isObject,t,{}),this.enabled=utils.isTypeOf(utils.isBoolean,this.data.enabled,!0),this.name=utils.isTypeOf(utils.isString,this.data.name,this.name),this.value=this.data.value||void 0},props.AbstractProp.prototype.update=function(){return!0},props.DomainProp=function(t){this.type="DomainProp",this.name="domain",this.set(t)},props.DomainProp.prototype=new props.AbstractProp,props.DomainProp.prototype.constructor=props.DomainProp,props.DomainProp.prototype.update=function(t){return!(!this.enabled||!utils.isString(t))&&(this.value=utils.extractRootDomain(t),!0)},props.FontProp=function(t){this.type="FontProp",this.name="font",this.set(t),this.step=utils.isTypeOf(utils.isNumber,this.data.step,1),this.min=utils.isTypeOf(utils.isNumber,this.data.min,4),this.max=utils.isTypeOf(utils.isNumber,this.data.max,32)},props.FontProp.prototype=new props.AbstractProp,props.FontProp.prototype.constructor=props.FontProp,props.FontProp.prototype.update=function(e,s,i){var r=this;if(!r.enabled||!utils.isElement(e)||isNaN(s)||isNaN(i))return!1;var t=parseInt(utils.getStyle(e,"fontSize",NaN)),a=function(t){return t>r.min&&(e.offsetWidth>s||e.offsetHeight>i)&&(--t,e.style.fontSize=t+"px",t=a(t)),t};return e.style.visibility="hidden",r.value=a(isNaN(t)?r.max:t),e.style.fontSize="",!(e.style.visibility="")},props.ModeProp=function(t){this.type="ModeProp",this.name="mode",this.set(t),this.options=utils.isTypeOf(utils.isArray,this.data.options,["live","capture","debug"])},props.ModeProp.prototype=new props.AbstractProp,props.ModeProp.prototype.constructor=props.ModeProp,props.ModeProp.prototype.update=function(t){return!!(this.enabled&&utils.isString(t)&&utils.arrayContains(this.options,t))&&(this.value=t,!0)},props.NameProp=function(t){this.type="NameProp",this.name="name",this.set(t)},props.NameProp.prototype=new props.AbstractProp,props.NameProp.prototype.constructor=props.NameProp,props.NameProp.prototype.update=function(t){return!(!this.enabled||!utils.isString(t))&&(this.value=t,!0)},props.OrientationProp=function(t){this.type="OrientationProp",this.name="orientation",this.set(t),this.options=utils.isTypeOf(utils.isArray,this.data.options,[[0,"portrait"],[.714,"square"],[1.5,"landscape"]])},props.OrientationProp.prototype=new props.AbstractProp,props.OrientationProp.prototype.constructor=props.OrientationProp,props.OrientationProp.prototype.update=function(t,e){return!(!this.enabled||isNaN(t)||isNaN(e))&&(this.value=utils.selectProperty(this.options,t/e),!0)},props.PositionProp=function(t){this.type="PositionProp",this.name="position",this.set(t),this.top=NaN,this.left=NaN,this.width=NaN,this.height=NaN,this.params=null},props.PositionProp.prototype=new props.AbstractProp,props.PositionProp.prototype.constructor=props.PositionProp,props.PositionProp.prototype.update=function(t,e,s,i,r){var a=this;if(!a.enabled||isNaN(t)||isNaN(e)||isNaN(s)||isNaN(i))return!1;a.params=utils.isTypeOf(utils.isObject,r,{}),a.params={align:utils.isTypeOf(utils.isArray,a.params.align,["center","middle"]),scale:utils.isTypeOf(utils.isString,a.params.scale,"fill"),crop:utils.isTypeOf(utils.isArray,a.params.crop,[0,0,0,0]),offset:utils.isTypeOf(utils.isArray,a.params.offset,[1,1])},a.params.offset[1]=1-t*(a.params.crop[1]+a.params.crop[3])/t,a.params.offset[0]=1-e*(a.params.crop[0]+a.params.crop[2])/e;var o=NaN,n=NaN,l=NaN,u=NaN;try{switch(i<=s?(n=s/t*e/a.params.offset[1],o=s/a.params.offset[1],"fill"===a.params.scale?i/a.params.offset[0]>n&&(o=i/e*t/a.params.offset[0],n=i/a.params.offset[0]):i/a.params.offset[0]<=n&&(o=i/e*t/a.params.offset[0],n=i/a.params.offset[0])):(o=i/e*t/a.params.offset[0],n=i/a.params.offset[0],"fill"===a.params.scale?s/a.params.offset[1]>o&&(n=s/t*e/a.params.offset[1],o=s/a.params.offset[1]):s/a.params.offset[1]<=o&&(n=s/t*e/a.params.offset[1],o=s/a.params.offset[1])),o=Math.ceil(o),n=Math.ceil(n),a.params.align[0]){case"left":l=0-o*a.params.crop[3];break;case"center":l=(s-o*a.params.offset[1])/2+(0-o*a.params.crop[3]);break;case"right":l=s-o+o*a.params.crop[1]}switch(l=Math.round(l),a.params.align[1]){case"top":u=0-n*a.params.crop[0];break;case"middle":u=(i-n*a.params.offset[0])/2+(0-n*a.params.crop[0]);break;case"bottom":u=i-n+n*a.params.crop[2]}u=Math.round(u)}catch(t){}return a.top=u,a.left=l,a.width=o,a.height=n,!0},props.ScaleProp=function(t){this.type="ScaleProp",this.name="scale",this.set(t),this.area={param:utils.isTypeOf(utils.isNumber,this.data.area,15e3),value:NaN},this.velocity={param:utils.isTypeOf(utils.isNumber,this.data.velocity,0),value:NaN},this.font={param:utils.isTypeOf(utils.isNumber,this.data.font,5),value:NaN},this.options=utils.isTypeOf(utils.isArray,this.data.options,[[0,"micro"],[6e3,"tiny"],[16e3,"small"],[4e4,"medium"],[25e4,"big"],[64e4,"huge"]]),this.ratio=Number(utils.isTypeOf(utils.isNumber,this.data.ratio,1))},props.ScaleProp.prototype=new props.AbstractProp,props.ScaleProp.prototype.constructor=props.ScaleProp,props.ScaleProp.prototype.update=function(t,e){var s=this;return!(!s.enabled||isNaN(t)||isNaN(e))&&(s.area.value=t*e,s.velocity.value=Math.sqrt(s.area.value/s.area.param),s.velocity.value=s.velocity.value+s.velocity.value*s.velocity.param/10,s.font.value=Math.round(s.font.param*s.ratio*s.velocity.value),s.value=utils.selectProperty(s.options,s.area.value),!0)},props.SizeProp=function(t){this.type="SizeProp",this.name="size",this.set(t),this.width=NaN,this.height=NaN},props.SizeProp.prototype=new props.AbstractProp,props.SizeProp.prototype.constructor=props.SizeProp,props.SizeProp.prototype.update=function(t,e){if(this.enabled){function s(t){return utils.isString(t)&&"%"===t.substr(t.length-1)&&(t=Number(t.substr(0,t.length-1))/100),t}if(t=s(t),e=s(e),!isNaN(t)&&!isNaN(e))return this.width=t,this.height=e,this.value=t+"x"+e,!0}return!1},props.TensionProp=function(t){this.type="TensionProp",this.name="tension",this.set(t),this.velocity={taller:utils.isTypeOf(utils.isNumber,utils.getObjectDeep(this.data,"velocity.taller"),-.5),wider:utils.isTypeOf(utils.isNumber,utils.getObjectDeep(this.data,"velocity.wider"),-1),value:NaN},this.options=utils.isTypeOf(utils.isArray,this.data.options,[[0,"tallest"],[.266,"taller"],[.444,"tall"],[.714,"equal"],[1.5,"wide"],[3,"wider"],[5,"widest"]])},props.TensionProp.prototype=new props.AbstractProp,props.TensionProp.prototype.constructor=props.TensionProp,props.TensionProp.prototype.update=function(t,e){var s=this;return!(!s.enabled||isNaN(t)||isNaN(e))&&(s.velocity.value=((e<=t?t/e:e/t)-1)*(e<=t?s.velocity.wider:10*s.velocity.taller)/100,s.value=utils.selectProperty(s.options,t/e),!0)};var layers=tactic.builder.layers;layers.AbstractLayer=function(){this.type="AbstractLayer"},layers.AbstractLayer.prototype.set=function(t,e,s,i,r,a){r=utils.isTypeOf(utils.isObject,r,{}),this.timestamp=(new Date).getTime(),this.data=utils.isTypeOf(utils.isObject,utils.cloneObject(e),{}),this.callback=utils.isTypeOf(utils.isFunction,s,utils.noop),this.parent=utils.isTypeOf(utils.isObject,i,null),this.root=this.root?this.root:this.parent?this.parent.root:void 0,this.registry=this.parent?this.parent.registry:{},this.sequence=this.sequence||(this.parent&&this.parent.sequence?this.parent.sequence:null),this.index=utils.isTypeOf(utils.isNumber,a,NaN),this.frame=NaN,this.parent&&("FrameLayer"===this.type?(this.frame=utils.isTypeOf(utils.isNumber,a,0),this.parent.frames.push(this)):(this.frame=this.parent.frame,this.parent.layers.push(this))),this.key=utils.isTypeOf(utils.isString,t,"UNDEFINED"),this.namespace=(this.parent&&this.parent.namespace?this.parent.namespace+".":"")+this.key,this.selector=(this.parent&&this.parent.selector?this.parent.selector+" ":"")+"[data-key="+this.key+"]",(this.registry[this.namespace]=this).target=r.target?r.target:this.getTarget(this.key),this.target||this.root!==this?!this.target&&this.data.create&&(this.target=document.createElement("div"),this.target.style.zIndex=utils.isTypeOf(utils.isNumber,this.data.index,""),this.target.setAttribute("data-key",this.key),this.parent&&this.parent.target?this.parent.target.appendChild(this.target):document.body.appendChild(this.target)):this.target=document.body,this.events={},this.timers={},this.layers=[],this.logs=[],this.macros={local:{},global:{}},this.props={},this.params={},(this.holder=this).wrapper=this.holder,this.attrs={local:[],global:[],hidden:[],styles:{}},this.sources=[],this.custom={},this.width=function(){return utils.isTypeOf(utils.isNumber,r.width,this.target.offsetWidth)},this.height=function(){return utils.isTypeOf(utils.isNumber,r.height,this.target.offsetHeight)},this.inited=void 0,this.enabled=void 0,this.loaded=void 0,this.entered=void 0},layers.AbstractLayer.prototype.init=function(){var t=this;if(t.inited||!t.target)return!1;var e=t.getAttrs(),s=t.getMacros(),i=utils.extractExceptions(utils.cloneObject(t.data),e,["macros","params","attrs","sources","custom"]);return delete i.layers,delete i.frames,t.enabled=!t.parent||!!t.parent.enabled&&utils.isTypeOf(utils.isBoolean,i.enabled,!0),t.enabled?(t.trigger({type:"enabled"}),t.initMacros(utils.extractExceptions(utils.replaceMacros(utils.isTypeOf(utils.isObject,i.macros,{}),s),e)),s=t.getMacros(),t.initProps(utils.extractExceptions(utils.replaceMacros(utils.isTypeOf(utils.isObject,i.props,{}),s),e)),s=t.getMacros(),t.initAttrs(utils.extractExceptions(utils.replaceMacros(utils.isTypeOf(utils.isObject,i.attrs,{}),s),e)),e=t.getAttrs(),t.initParams(utils.extractExceptions(utils.replaceMacros(utils.isTypeOf(utils.isObject,i.params,{}),s),e)),t.initSources(utils.extractExceptions(utils.replaceMacros(utils.isTypeOf(utils.isObject,i.sources,{}),s),e)),t.initCustom(utils.extractExceptions(utils.replaceMacros(utils.isTypeOf(utils.isObject,i.custom,{}),s),e)),t.initHolder(t.params.holder),t.initWrapper(t.params.wrapper)):t.trigger({type:"disabled"}),t.inited=!0,t.timers.init=setTimeout(function(){t.trigger({type:"init"})},0),!0},layers.AbstractLayer.prototype.initHolder=function(t,e){var s=this;return!s.inited&&(s.holder=utils.isTypeOf(utils.isObject,s.getLayer(s.params.holder,s.params.depth),s),!0)},layers.AbstractLayer.prototype.initWrapper=function(t,e){var s=this;return!s.inited&&(s.wrapper=utils.isTypeOf(utils.isObject,s.getLayer(s.params.wrapper,s.params.depth),s.holder?s.holder:s),!0)},layers.AbstractLayer.prototype.initMacros=function(t){return!this.inited&&this.addMacros(t)},layers.AbstractLayer.prototype.initProps=function(t){var e=this;return!e.inited&&(e.props={},t.orientation&&(e.props.orientation=new props.OrientationProp(t.orientation),e.props.orientation.update(e.width(),e.height()),e.props.orientation.enabled&&e.addAttr(e.props.orientation.name,{name:e.props.orientation.name+"_"+e.props.orientation.value,global:!0})),!0)},layers.AbstractLayer.prototype.initParams=function(t){return!this.inited&&(this.params={holder:utils.isTypeOf(utils.isString,t.holder,null),wrapper:utils.isTypeOf(utils.isString,t.wrapper,null),depth:utils.isTypeOf(utils.isNumber,t.depth,-5)},!0)},layers.AbstractLayer.prototype.initAttrs=function(t){return!this.inited&&this.addAttrs(t)},layers.AbstractLayer.prototype.initSources=function(t){return!this.inited&&(utils.isArray(t)&&0<t.length?this.sources=t:this.sources=[],!0)},layers.AbstractLayer.prototype.initCustom=function(t){return!this.inited&&(this.custom=t,!0)},layers.AbstractLayer.prototype.load=function(){return!(!this.inited||this.loaded)&&(this.loaded=!0,this.trigger({type:"load"}),!0)},layers.AbstractLayer.prototype.unload=function(){return this.inited&&this.loaded&&(this.loaded=!1,this.trigger({type:"unload"})),this.inited},layers.AbstractLayer.prototype.loadable=function(){return!(!this.inited||!this.enabled)&&(!this.sequence||this.entered)},layers.AbstractLayer.prototype.destroy=function(){var s=this;return!!s.inited&&(utils.each(s.timers,function(t){clearTimeout(t)}),utils.each(s.events,function(t,e){t&&(s.events[e]=utils.removeEventSimple(t.target,t.type,t.callback))}),s.unload(),utils.removeClasses(s.target,s.attrs.local),s.attrs.local=[],utils.removeClasses(s.target,s.attrs.global),s.attrs.global=[],s.attrs.hidden=[],utils.each(s.attrs.styles,function(t,e){t&&(utils.deleteCssRule(t.sheet,t.rule),delete s.attrs.styles[e])}),s.params={},s.macros.local={},s.macros.global={},s.inited=!1,s.trigger({type:"destroy"}),s.custom={},!0)},layers.AbstractLayer.prototype.trigger=function(t){return this.logs.push([((new Date).getTime()-(this.root?this.root.timestamp:(new Date).getTime())/1e3).toFixed(2),t.type,t.detail&&t.detail.key?t.detail.key:null]),this.callback(t)},layers.AbstractLayer.prototype.execute=function(t,e,s,i,r){var a=this;if(r=isNaN(r)?100:r,!e||i&&utils.arrayContains(i,a.key)||(utils.isFunction(t)?t.apply(a,s):utils.isFunction(a[t])&&a[t].apply(a,s)),0<r){for(var o in a.layers)a.layers[o].execute(t,!0,s,i,r-1);if(a.frames)for(var n in a.frames)a.frames[n].execute(t,!0,s,i,r-1)}},layers.AbstractLayer.prototype.available=function(){var t=this;return!!(t.inited&&t.enabled&&t.loaded)&&(!t.sequence||!!t.entered)},layers.AbstractLayer.prototype.playable=function(){return!!this.available()&&(!this.root||!this.root.stopped)},layers.AbstractLayer.prototype.addMacro=function(key,macro){var that=this;if(utils.isEmptyString(key))return!1;if(utils.isString(macro)||utils.isNumber(macro)||utils.isBoolean(macro))that.macros.local[key]=macro;else{if(!utils.isObject(macro)||!1===macro.enabled)return!1;var type=!0===macro.global?"global":"local";if(utils.isEmptyString(macro.calc))that.macros[type][key]=macro.value;else try{that.macros[type][key]=eval(utils.replaceMacros(macro.calc,{value:macro.value}))}catch(t){}}return!0},layers.AbstractLayer.prototype.addMacros=function(t){var s=this;return!!utils.isObject(t)&&(utils.each(t,function(t,e){s.addMacro(e,t)}),!0)},layers.AbstractLayer.prototype.getMacros=function(s,i){var r={};return utils.each(this.macros,function(t,e){"local"===e&&s||utils.each(t,function(t,e){i&&!utils.isUndefined(i[e])||(r[e]=t)})}),this.parent&&(r=utils.mergeObjects(r,this.parent.getMacros(!0,r))),r},layers.AbstractLayer.prototype.addAttr=function(i,r){var a=this;if(utils.isEmptyString(i))return!1;if(r){if(!utils.isObject(r)||!1===r.enabled)return!1;var o=!0===r.global?"global":"local";r.macros&&(r.css=utils.replaceMacros(r.css,r.macros)),utils.each(utils.isArray(r.selector)?r.selector:[r.selector?r.selector:""],function(t){if(r.css){var e=r.name?r.name:i+(""===t?"":"_"+t.replace(/[^a-zA-Z0-9]/g,"_")),s=utils.createCssString(r.css);a.attrs.styles[e]&&a.removeAttrs(e),a.attrs.styles[e]=utils.createCssRule(a.selector+(r.name?" ."+r.name:"")+(":"===t.substr(0,1)?t:" "+t),s)}r.name?utils.arrayContains(a.attrs[o],r.name)||(a.attrs[o].push(r.name),utils.addClass(a.target,r.name)):utils.arrayContains(a.attrs.hidden,e)||a.attrs.hidden.push(e)})}else utils.arrayContains(a.attrs.local,i)||(a.attrs.local.push(i),utils.addClass(a.target,i));return!0},layers.AbstractLayer.prototype.addAttrs=function(t){var s=this;if(utils.isString(t)&&(t=[t]),utils.isArray(t))utils.each(t,function(t){s.addAttr(t)});else{if(!utils.isObject(t))return!1;utils.each(t,function(t,e){s.addAttr(e,t)})}return!0},layers.AbstractLayer.prototype.getAttrs=function(s){var i=[];return utils.each(this.attrs,function(t,e){"local"===e&&s||"styles"===e||utils.each(t,function(t){i=i.concat(t)})}),this.parent&&(i=i.concat(this.parent.getAttrs(!0))),i},layers.AbstractLayer.prototype.removeAttr=function(t){function e(t,e){for(var s in t)if(t.hasOwnProperty(s)&&t[s]===e){t.splice(s,1),i.attrs.styles[e]&&(utils.deleteCssRule(i.attrs.styles[e].sheet,i.attrs.styles[e].rule),delete i.attrs.styles[e]);break}}var i=this;return utils.isString(t)&&(e(i.attrs.local,t),e(i.attrs.global,t),e(i.attrs.hidden,t),utils.removeClass(i.target,t)),!1},layers.AbstractLayer.prototype.removeAttrs=function(t){var e=this;return!(!t||(utils.isString(t)&&(t=[t]),!utils.isArray(t)))&&(utils.each(t,function(t){e.removeAttr(t)}),!0)},layers.AbstractLayer.prototype.addLayer=function(t,e,s,i,r,a){return utils.isFunction(t)?new t(e,s,i,this,r,a):null},layers.AbstractLayer.prototype.getLayer=function(t,e){var s,i,r=this.layers;for(s in r)if((i=r[s]).key===t)return i;if(0<e)for(s in r){var a=(i=r[s]).getLayer(t,e-1);if(a)return a}else if(e<0&&this.parent)return this.parent.getLayer(t,e+1);return null},layers.AbstractLayer.prototype.getLayers=function(a){if(utils.isEmptyString(a))return[];var o=[];return this.registry[a]?o.push(this.registry[a]):utils.each(this.registry,function(t){if(t.key===a)o.push(t);else if(-1!==a.indexOf("#"))if(-1!==a.indexOf(".")){var e=a.split("."),s=t.namespace.split(".");if(s.length===e.length){for(var i=utils.cloneObject(s),r=0;r<e.length;r++)-1!==e[r].indexOf("#")&&(i[r]=i[r].replace(/[0-9]/g,"#"));utils.isEqualArray(e,i)&&o.push(t)}}else{utils.cloneObject(t.key).replace(/[0-9]/g,"#")===a&&o.push(t)}}),o},layers.AbstractLayer.prototype.getTarget=function(t){var e=utils.getElementsByKey(this.target,t)[0];return!e&&this.parent&&(e=utils.getElementsByKey(this.parent.target,t)[0]),e=e||utils.getElementsByKey(document.body,t)[0]},layers.AdaptiveLayer=function(t,e,s,i,r,a){this.type="AdaptiveLayer",this.set(t,e,s,i,r,a),this.props={tension:null,scale:null,font:null},this.trigger({type:"set"})},layers.AdaptiveLayer.prototype=new layers.AbstractLayer,layers.AdaptiveLayer.prototype.constructor=layers.AdaptiveLayer,layers.AdaptiveLayer.prototype.initProps=function(t){var e=this;return!e.inited&&(e.props.scale=new props.ScaleProp(t.scale),e.props.scale.update(e.width(),e.height()),e.props.scale.enabled&&(e.addAttr(e.props.scale.name,{global:!0,name:e.props.scale.name+"_"+e.props.scale.value}),0<e.props.scale.font.value&&e.addAttr(e.props.scale.name+"_font",{css:{"font-size":e.props.scale.font.value+"px"}})),e.props.tension=new props.TensionProp(t.tension),e.props.tension.update(e.width(),e.height()),e.props.tension.enabled&&e.addAttr(e.props.tension.name,{global:!0,name:e.props.tension.name+"_"+e.props.tension.value}),t.orientation&&(e.props.orientation=new props.OrientationProp(t.orientation),e.props.orientation.update(e.width(),e.height()),e.props.orientation.enabled&&e.addAttr(e.props.orientation.name,{name:e.props.orientation.name+"_"+e.props.orientation.value,global:!0})),!0)},layers.BannerLayer=function(t,e,s,i){this.type="BannerLayer",(this.root=this).set(t,e,s,null,i),this.target.setAttribute("data-key",this.key),this.props={domain:null,vendor:null,name:null,size:null,mode:null},this.definition={},this.clicktag={},this.feeds={},this.fonts={},this.assets={},this.events={resize:null},this.mode=null,this.inanimate=!this.target||(!this.target.style||void 0===this.target.style.animation),this.enabled=!0,this.loaded=!1,this.stopped=void 0,this.captured=!1,this.entered=!0,this.trigger({type:"set"})},layers.BannerLayer.prototype=new layers.AbstractLayer,layers.BannerLayer.prototype.constructor=layers.BannerLayer,layers.BannerLayer.prototype.init=function(){var t=this;if(t.inited)return!1;var e,s,i=utils.cloneObject(t.data);return t.initMode(/PhantomJS/i.test(navigator.userAgent)?"capture":i.mode),t.initMacros(utils.isTypeOf(utils.isObject,i.macros,{})),t.addMacro("package_url",{global:!0,value:tactic.url.package}),s=t.getMacros(),t.initProps(utils.replaceMacros(utils.isTypeOf(utils.isObject,i.props,{}),s)),s=t.getMacros(),e=t.getAttrs(),t.initAttrs(utils.extractExceptions(utils.replaceMacros(utils.isTypeOf(utils.isObject,i.attrs,{}),s),e)),e=t.getAttrs(),t.initParams(utils.replaceMacros(utils.isTypeOf(utils.isObject,i.params,{}),s)),t.initDefinition(utils.extractExceptions(utils.replaceMacros(utils.isTypeOf(utils.isObject,i.definition,{}),s),e)),t.initClicktag(utils.extractExceptions(utils.replaceMacros(utils.isTypeOf(utils.isObject,i.clicktag,{}),s),e)),t.initFeeds(utils.extractExceptions(utils.replaceMacros(utils.isTypeOf(utils.isObject,i.feeds,{}),s),e)),t.initFonts(utils.extractExceptions(utils.replaceMacros(utils.isTypeOf(utils.isObject,i.fonts,{}),s),e)),t.initSources(),t.initCustom(utils.extractExceptions(utils.replaceMacros(utils.isTypeOf(utils.isObject,i.custom,{}),s),e)),t.build(i.layers,t),t.timers.stop=setTimeout(function(){t.stop()},t.params.stop.after-((new Date).getTime()-t.timestamp)),t.events.resize=utils.addEventSimple(window,"resize",function(){t.resize.apply(t)}),t.inited=!0,t.timers.init=setTimeout(function(){t.trigger({type:"init"})},0),!0},layers.BannerLayer.prototype.initMode=function(t){return!this.inited&&(this.mode="capture"===t?t:0<container.ADVERT_ID?"live":utils.isTypeOf(utils.isString,t,"live"),!0)},layers.BannerLayer.prototype.initProps=function(t){var s=this;return!s.inited&&(t=utils.isTypeOf(utils.isObject,t,{}),s.props.domain=new props.DomainProp(t.domain),s.props.domain.update(container.HOST),s.props.vendor=new props.NameProp(utils.mergeObjects({name:"vendor"},t.vendor||{})),s.props.vendor.update(container.MEDIA),s.props.name=new props.NameProp(t.name),s.props.name.update(container.NAME),s.props.size=new props.SizeProp(t.size),s.props.size.update(container.WIDTH,container.HEIGHT),s.props.mode=new props.ModeProp(t.mode),s.props.mode.update(s.mode),utils.each(s.props,function(t,e){t.enabled&&(s.addMacro(t.name,{global:!0,value:t.value}),"domain"!==e&&s.addAttr(t.name,{global:!0,name:t.name+"_"+t.value}))}),!0)},layers.BannerLayer.prototype.initDefinition=function(t){return!this.inited&&(this.definition=t,!0)},layers.BannerLayer.prototype.initClicktag=function(t){return!this.inited&&(this.clicktag={override:utils.isTypeOf(utils.isBoolean,t.override,!1),synchronise:utils.isTypeOf(utils.isBoolean,t.synchronise,!1),url:utils.isTypeOf(utils.isUrl,t.url,""),options:utils.isTypeOf(utils.isArray,t.options,[])},!0)},layers.BannerLayer.prototype.initFeeds=function(t){return!this.inited&&(this.feeds=t,!0)},layers.BannerLayer.prototype.initFonts=function(t){var a=this;return!a.inited&&(utils.each(t,function(s,e){if(s&&!utils.isEmptyString(s.url)&&!1!==s.enabled){s.name&&utils.isBoolean(s.name)&&(s.name=e);var i={"font-family":e,"font-weight":utils.isTypeOf(utils.isString,s.weight,"normal"),"font-style":utils.isTypeOf(utils.isString,s.style,"normal"),src:[[],[]]};utils.each(s.types,function(t,e){switch(t){case"eot":i.src[0].push({url:s.url+"."+t}),i.src[1].push({url:s.url+"."+t+"#iefix",format:"embedded-opentype"});break;default:i.src[1].push({url:s.url+"."+t,format:t})}});var t=utils.createCssRule("@font-face",utils.createCssFontString(i));a.attrs.styles[e]=t,a.fonts[e]={loaded:!1,style:t},utils.isEmptyString(s.name)||a.addAttr(e,{selector:"."+s.name,css:{"font-family":e}}),utils.isArray(s.selectors)&&utils.each(s.selectors,function(t){utils.isEmptyString(t)||a.addAttr(e,{selector:t,css:{"font-family":e}})})}else{var r=utils.arrayIndex(a.params.wait.fonts,e);-1<r&&a.params.wait.fonts.splice(r,1)}}),!0)},layers.BannerLayer.prototype.initParams=function(t){return!this.inited&&(this.params={holder:utils.isTypeOf(utils.isString,t.holder,null),wrapper:utils.isTypeOf(utils.isString,t.wrapper,null),depth:utils.isTypeOf(utils.isNumber,t.depth,-5),wait:{fonts:utils.isTypeOf(utils.isArray,utils.getObjectDeep(t,"wait.fonts"),[]),assets:utils.isTypeOf(utils.isArray,utils.getObjectDeep(t,"wait.assets"),[]),feeds:utils.isTypeOf(utils.isArray,utils.getObjectDeep(t,"wait.feeds"),[]),timeout:utils.isTypeOf(utils.isNumber,utils.getObjectDeep(t,"wait.timeout"),5e3)},stop:{after:utils.isTypeOf(utils.isNumber,utils.getObjectDeep(t,"stop.after"),3e4)},capture:{delay:utils.isTypeOf(utils.isNumber,utils.getObjectDeep(t,"capture.delay"),3e3)},resize:{delay:utils.isTypeOf(utils.isNumber,utils.getObjectDeep(t,"resize.delay"),500)}},!0)},layers.BannerLayer.prototype.initSources=function(){var r=this;if(r.inited)return!1;var t=[].slice.call(r.target.getElementsByTagName("img")).concat([].slice.call(r.target.getElementsByTagName("video")));return utils.each(t,function(t){if(t){var e=t.getAttribute("data-key"),s=t.getAttribute("data-source");if(utils.isEmptyString(e)||utils.isEmptyString(s)||t.src){var i=utils.arrayIndex(r.params.wait.assets,e);-1<i&&r.params.wait.assets.splice(i,1)}else r.assets[e]={target:t,source:s,polite:"true"===t.getAttribute("data-polite")},"true"===t.getAttribute("data-wait")&&utils.arrayIndex(r.params.wait.assets,e)<0&&r.params.wait.assets.push(e)}}),!0},layers.BannerLayer.prototype.build=function(t,a){var o=this;return!o.inited&&(utils.each(t,function(t,e){var s=utils.isTypeOf(utils.isFunction,t?layers[utils.isString(t.type)?t.type.split("Component").join("Layer"):null]:null,null),i=utils.isNumber(e)?a.key+"_"+e:e,r=o.trigger({type:"build",detail:{Constructor:s,key:i,index:Number(e),data:t,parent:a}});!r&&s&&(r=a.addLayer(s,i,t,o.callback,null,Number(e))),r&&t&&(t.layers&&o.build(t.layers,r),t.frames&&o.build(t.frames,r))}),!0)},layers.BannerLayer.prototype.load=function(){var i=this;if(i.loaded)return!1;function r(t){i.loaded||(t&&t.count++,(e||a.count>=a.list.length&&n.count>=n.list.length&&o.count>=o.list.length)&&(clearTimeout(i.timers.load),i.loaded=!0,i.trigger({type:"load"})))}function s(t){var e=this;e.src&&-1!==e.src.indexOf(".svg")?e.src=e.src.replace(/.svg$/,".png"):(utils.removeEventSimple(e,"error",l),r(o))}var e=!1,a={list:i.params.wait.fonts,count:0},o={list:i.params.wait.assets,count:0},n={list:i.params.wait.feeds,count:0},l=function(t){utils.removeEventSimple(this,"load",l),r(o)};return utils.each(i.feeds,function(t,s){t&&(i.feeds[s].key=s,t.enabled&&utils.isUrl(t.source)&&(n.list.push(t.source),utils.get(t.source+"&r="+Math.round(999999999*Math.random()),function(t){try{if("csv"===i.feeds[s].type){var e=utils.CSVToArray(t.responseText);i.feeds[s].data={meta:{},index:e[0],items:e},i.feeds[s].data.items.shift()}else i.feeds[s].data=JSON.parse(t.responseText).data;i.feeds[s].loaded=!0}catch(t){i.feeds[s].loaded=!1}r(n)},function(t){i.feeds[s].loaded=!0,r(n)})))}),utils.each(a.list,function(t){utils.isEmptyString(t)||utils.watchFont(t,null,function(t,e){i.fonts[t]&&(i.fonts[t].loaded=e),r(a)})}),utils.each(i.assets,function(t,e){t.target&&(0<=utils.arrayIndex(i.params.wait.assets,e)&&(utils.addEventSimple(t.target,"error",s),utils.addEventSimple(t.target,"load",l)),t.polite&&!container.isPoliteReady()?container.one(container.EVT_ADAPTER_POLITE,function(){t.target.src=utils.getAssetUrl(t.source)}):t.target.src=utils.getAssetUrl(t.source))}),r(),i.timers.load=setTimeout(function(){e=!0,r()},i.params.wait.timeout),!0},layers.BannerLayer.prototype.capture=function(){var t=this;return!(!t.inited||t.captured)&&(t.timers.capture=setTimeout(function(){t.trigger({type:"capture"}),t.timers.capture=setTimeout(function(){t.captured=!0,window.TACTIC_CAPTURE=!0},t.params.capture.delay)},0),!0)},layers.BannerLayer.prototype.stop=function(){return!!this.inited&&(clearTimeout(this.timers.stop),this.stopped=!0,this.trigger({type:"stop"}),!0)},layers.BannerLayer.prototype.destroy=function(){return!1},layers.BannerLayer.prototype.resize=function(){var t=this;return!!t.inited&&(clearTimeout(t.timers.resize),t.timers.resize=setTimeout(function(){t.trigger({type:"resize"})},t.params.resize.delay),!0)},layers.BannerLayer.prototype.getClickTag=function(t){var e=this;return{url:e.clicktag.override?e.clicktag.options[t]&&utils.isUrl(e.clicktag.options[t].url)?e.clicktag.options[t].url:e.clicktag.url:"",vars:e.clicktag.synchronise?e.definition:{}}},layers.FrameLayer=function(t,e,s,i,r,a){this.type="FrameLayer",this.set(t,e,s,i,r,a),this.trigger({type:"set"})},layers.FrameLayer.prototype=new layers.AbstractLayer,layers.FrameLayer.prototype.constructor=layers.FrameLayer,layers.FrameLayer.prototype.initParams=function(t){return!this.inited&&(this.params={holder:utils.isTypeOf(utils.isString,t.holder,null),wrapper:utils.isTypeOf(utils.isString,t.wrapper,null),depth:utils.isTypeOf(utils.isNumber,t.depth,-5),duration:utils.isTypeOf(utils.isNumber,t.duration,0)},!0)},layers.ImageLayer=function(t,e,s,i,r,a){this.type="ImageLayer",this.set(t,e,s,i,r,a),this.props={position:null,orientation:null},this.asset={target:null,key:this.key+"_ASSET",tags:null,source:null},this.trigger({type:"set"})},layers.ImageLayer.prototype=new layers.AbstractLayer,layers.ImageLayer.prototype.constructor=layers.ImageLayer,layers.ImageLayer.prototype.initProps=function(t){var e=this;return!e.inited&&(e.props.position=new props.PositionProp(t.position),e.props.orientation=new props.OrientationProp(t.orientation),e.props.orientation.update(e.width(),e.height()),e.props.orientation.enabled&&e.addAttr(e.props.orientation.name,{name:e.props.orientation.name+"_"+e.props.orientation.value}),!0)},layers.ImageLayer.prototype.initParams=function(t){return!this.inited&&(this.params={holder:utils.isTypeOf(utils.isString,t.holder,null),wrapper:utils.isTypeOf(utils.isString,t.wrapper,null),depth:utils.isTypeOf(utils.isNumber,t.depth,-5),tags:utils.isTypeOf(utils.isArray,t.tags,[]),polite:utils.isTypeOf(utils.isBoolean,t.polite,!1),align:utils.isTypeOf(utils.isArray,t.align,["center","middle"]),crop:utils.isTypeOf(utils.isArray,t.crop,[0,0,0,0]),scale:utils.isTypeOf(utils.isString,t.scale,"fill"),ratio:Number(utils.isTypeOf(utils.isNumber,t.ratio,1))},!0)},layers.ImageLayer.prototype.load=function(){var i=this;if(!i.inited||!i.enabled||i.loaded||i.asset.target)return!1;if(0<i.sources.length){function t(){i.asset.target.src=utils.getAssetUrl(i.asset.source)}function e(){i.addAttr(i.props.position.name,{selector:'[data-key="'+i.asset.key+'"]',css:{position:"absolute",left:i.props.position.left+"px",top:i.props.position.top+"px",width:i.props.position.width+"px",height:i.props.position.height+"px"}})}var s=function(t){i.events.load=utils.removeEventSimple(i.asset.target,"load",s),i.props.position.enabled&&(isNaN(i.props.position.width)||isNaN(i.props.position.height))&&(i.props.position.update(i.asset.target.width,i.asset.target.height,i.width(),i.height(),i.params),e()),i.loaded=!0,i.trigger({type:"load"})},r=function(t){var e=i.asset.target;if(e){utils.removeEventSimple(e,"error",r);var s=e.src;s&&-1!==s.indexOf(".svg")&&(e.src=s.replace(/.svg$/,".png"))}};i.asset.target=document.createElement("img"),i.asset.tags=utils.wrapElement(i.params.tags),i.asset.target.setAttribute("data-key",i.asset.key),i.asset.tags=utils.wrapElement(i.params.tags),i.asset.tags&&utils.isElement(i.asset.tags.initial)&&utils.isElement(i.asset.tags.latest)?(i.target.appendChild(i.asset.tags.initial),i.asset.tags.latest.appendChild(i.asset.target)):i.target.appendChild(i.asset.target),i.events.load=utils.addEventSimple(i.asset.target,"load",s),i.events.error=utils.addEventSimple(i.asset.target,"error",r),i.props.position.update(i.sources[0].width,i.sources[0].height,i.width(),i.height(),i.params),i.props.position.enabled?(i.asset.source=utils.getAssetSource(i.sources,i.props.position.width*i.params.ratio,i.props.position.height*i.params.ratio),isNaN(i.props.position.width)||isNaN(i.props.position.height)||e()):i.asset.source=utils.getAssetSource(i.sources,i.width()*i.params.ratio,i.height()*i.params.ratio),!0!==i.params.polite||container.isPoliteReady()?t():container.one(container.EVT_ADAPTER_POLITE,function(){t()})}else i.trigger({type:"empty"});return!0},layers.ImageLayer.prototype.unload=function(){var t=this;return t.inited&&t.loaded&&(t.asset.tags&&t.asset.tags.initial?t.target.removeChild(t.asset.tags.initial):t.asset.target&&t.target.removeChild(t.asset.target),t.asset.tags=null,t.asset.source=null,t.asset.target=null,t.loaded=!1,t.trigger({type:"unload"})),!1},layers.JointLayer=function(t,e,s,i,r,a){this.type="JointLayer",this.set(t,e,s,i,r,a),this.trigger({type:"set"})},layers.JointLayer.prototype=new layers.AbstractLayer,layers.JointLayer.prototype.constructor=layers.JointLayer,layers.SequenceLayer=function(t,e,s,i,r,a){this.type="SequenceLayer",(this.sequence=this).frames=[],this.set(t,e,s,i,r,a),this.previous=null,this.current=null,this.next=null,this.history=[],this.state=NaN,this.direction=NaN,this.loops=0,this.changes=0,this.looped=!1,this.repeated=!1,this.paused=void 0,this.stopped=!1,this.trigger({type:"set"})},layers.SequenceLayer.prototype=new layers.AbstractLayer,layers.SequenceLayer.prototype.constructor=layers.SequenceLayer,layers.SequenceLayer.prototype.initParams=function(t){return!this.inited&&(this.params={holder:utils.isTypeOf(utils.isString,t.holder,null),wrapper:utils.isTypeOf(utils.isString,t.wrapper,null),depth:utils.isTypeOf(utils.isNumber,t.depth,-5),play:{after:{time:utils.isTypeOf(utils.isNumber,utils.getObjectDeep(t,"play.after.time"),0)},from:utils.isTypeOf(utils.isNumber,utils.getObjectDeep(t,"play.from"),0)},pause:{after:{time:utils.isTypeOf(utils.isNumber,utils.getObjectDeep(t,"pause.after.time"),NaN),frame:utils.isTypeOf(utils.isNumber,utils.getObjectDeep(t,"pause.after.frame"),NaN),loop:utils.isTypeOf(utils.isNumber,utils.getObjectDeep(t,"pause.after.loop"),NaN)}},stop:{on:utils.isTypeOf(utils.isNumber,utils.getObjectDeep(t,"stop.on"),NaN)},load:{before:utils.isTypeOf(utils.isNumber,utils.getObjectDeep(t,"load.before"),0),after:utils.isTypeOf(utils.isNumber,utils.getObjectDeep(t,"load.after"),1)},direction:utils.isTypeOf(utils.isNumber,t.direction,1)},!0)},layers.SequenceLayer.prototype.play=function(){var t=this;return!(!t.inited||!t.enabled)&&(clearTimeout(t.timers.play),clearTimeout(t.timers.change),clearTimeout(t.timers.pause),t.stopped?t.change(t.state):utils.isUndefined(t.paused)?(t.paused=!1,t.timers.play=setTimeout(function(){t.trigger({type:"play"}),t.change(t.params.play.from)},t.params.play.after.time),isNaN(t.params.pause.after.time)||(t.timers.pause=setTimeout(function(){t.pause()},t.params.pause.after.time))):(t.paused=!1,t.trigger({type:"play"}),t.change(t.state)),!0)},layers.SequenceLayer.prototype.pause=function(){var t=this;return!(!t.inited||!t.enabled)&&(clearTimeout(t.timers.play),clearTimeout(t.timers.change),clearTimeout(t.timers.pause),!1===t.paused&&(t.paused=!0,isNaN(t.state)||t.trigger({type:"pause"})),!0)},layers.SequenceLayer.prototype.stop=function(t){var e=this;return!(!e.inited||!e.enabled)&&(e.pause(),e.stopped=!0,isNaN(e.state)||(isNaN(e.params.stop.on)||t||e.change(e.params.stop.on),e.trigger({type:"stop"})),!0)},layers.SequenceLayer.prototype.toggle=function(){var t=this;return t.inited&&t.enabled?(t.paused?t.play():t.pause(),t.trigger({type:"toggle"}),t.state):NaN},layers.SequenceLayer.prototype.change=function(t){var e=this;if(e.inited&&e.enabled){function s(t){return isNaN(t)&&(t=isNaN(e.state)?0:e.state),(t<0||t>=e.frames.length)&&(t=0<=e.direction?t<0?e.frames.length-1:0:0<t?0:e.frames.length-1),t}return clearTimeout(e.timers.change),e.looped=!1,e.repeated=!1,isNaN(e.direction)&&(e.direction=e.params.direction),t=s(t),e.state!==t?(e.state=t,e.changes++):e.repeated=!0,e.history.push(e.state),1<e.frames.length&&(e.current&&e.current!==e.frames[e.state]?e.previous=e.current:e.previous&&(e.previous=e.frames[s(e.state-e.direction)]),e.next=e.frames[s(e.state+e.direction)]),e.current=e.frames[e.state],!1===e.paused&&!0!==e.stopped&&e.current&&e.current.inited&&1<e.frames.length&&0<e.current.params.duration&&(e.timers.change=setTimeout(function(){!isNaN(e.params.pause.after.loop)&&e.loops>=e.params.pause.after.loop||!isNaN(e.params.pause.after.frame)&&e.changes>=e.params.pause.after.frame?e.pause():e.change(e.state+e.direction)},e.current.params.duration)),e.changes/e.frames.length-1>=e.loops&&(e.loops++,e.looped=!0),this.current&&this.previous&&this.previous.hash===this.current.hash&&(e.repeated=!0),e.current&&e.current.execute(function(){var t=this;clearTimeout(t.timers.enter),t.timers.enter=setTimeout(function(){t.entered=!0,t.trigger({type:"enter"})},0)},!0),e.previous&&e.previous.execute(function(){var t=this;clearTimeout(t.timers.leave),t.timers.leave=setTimeout(function(){t.trigger({type:"leave"}),t.entered=!1},0)},!0),e.trigger({type:"change"}),e.state}return NaN},layers.SequenceLayer.prototype.changeNext=function(){var t=this;return t.inited&&t.enabled?(t.trigger({type:"next"}),t.change(t.state+t.direction)):NaN},layers.SequenceLayer.prototype.changePrevious=function(){var t=this;return t.inited&&t.enabled?(t.trigger({type:"previous"}),t.change(t.state-t.direction)):NaN},layers.SequenceLayer.prototype.reverse=function(){var t=this;return t.inited&&t.enabled?(t.direction=-t.direction,t.trigger({type:"reverse"}),t.direction):NaN},layers.SequenceLayer.prototype.load=function(){var t=this;if(t.inited&&t.enabled){var e=[],s=0;t.state-t.params.load.before<0&&(s=t.params.load.before-t.state);var i=0;for(var r in t.state+t.params.load.after>t.frames.length-1&&(i=t.params.load.after+t.state-(t.frames.length-1)),t.frames){var a=!1;r>=t.state-t.params.load.before&&r<=t.state+t.params.load.after||r>=t.frames.length-s?a=!0:r<=i-1&&(a=!0),a&&t.frames[r].execute("load",!0),e.push(a)}return t.loaded=!0,t.timers.load=setTimeout(function(){t.trigger({type:"load",detail:{list:e}})},0),!0}return!1},layers.TextLayer=function(t,e,s,i,r,a){this.type="TextLayer",this.set(t,e,s,i,r,a),this.props={font:null},this.asset={target:null,key:this.key+"_ASSET",tags:null,source:null},this.trigger({type:"set"})},layers.TextLayer.prototype=new layers.AbstractLayer,layers.TextLayer.prototype.constructor=layers.TextLayer,layers.TextLayer.prototype.initProps=function(t){return!this.inited&&(this.props.font=new props.FontProp(utils.isTypeOf(utils.isObject,t.font,{})),!0)},layers.TextLayer.prototype.initParams=function(t){return!this.inited&&(this.params={holder:utils.isTypeOf(utils.isString,t.holder,null),wrapper:utils.isTypeOf(utils.isString,t.wrapper,null),depth:utils.isTypeOf(utils.isNumber,t.depth,-5),tags:utils.isTypeOf(utils.isArray,t.tags,[]),line:{before:utils.isTypeOf(utils.isString,utils.getObjectDeep(t,"line.before"),""),after:utils.isTypeOf(utils.isString,utils.getObjectDeep(t,"line.after"),"<br/>")},wait:{fonts:utils.isTypeOf(utils.isBoolean,utils.getObjectDeep(t,"wait.fonts"),!0),timeout:utils.isTypeOf(utils.isNumber,utils.getObjectDeep(t,"wait.timeout"),1e3)}},!0)},layers.TextLayer.prototype.initSources=function(t){if(this.inited)return!1;if(utils.isArray(t)&&0<t.length){for(var e=t.length-1;0<=e;e--)isNaN(t[e].text)||(t[e].text+=""),utils.isEmptyString(t[e].text)&&t.splice(e,1);this.sources=t,this.sources.sort(function(t,e){return t.length<e.length?1:t.length>e.length?-1:0})}else this.sources=[];return!0},layers.TextLayer.prototype.load=function(){var e=this;if(!e.inited||!e.enabled||e.loaded||e.asset.target)return!1;if(0<e.sources.length){e.asset.target=document.createElement("span"),e.asset.tags=utils.wrapElement(e.params.tags),e.asset.target.setAttribute("data-key",e.asset.key),e.asset.tags&&utils.isElement(e.asset.tags.initial)&&utils.isElement(e.asset.tags.latest)?(e.target.appendChild(e.asset.tags.initial),e.asset.tags.latest.appendChild(e.asset.target)):e.target.appendChild(e.asset.target);function s(){e.timers.load=setTimeout(function(){for(var t=0;t<e.sources.length&&(e.asset.source=e.sources[t],e.asset.target.innerHTML=e.params.line.before+e.asset.source.text.split(/\r\n|\n|\r/).join(e.params.line.after+e.params.line.before).split("  ").join(" &nbsp;")+e.params.line.after,!(e.holder.width()<=e.wrapper.width()&&e.holder.height()<=e.wrapper.height()));t++);e.props.font.update(e.holder.target,e.wrapper.width(),e.wrapper.height()),e.props.font.enabled&&e.holder.addAttr(e.props.font.name,{css:{"font-size":e.props.font.value+"px"}}),e.loaded=!0,e.trigger({type:"load"})},0)}e.params.wait.fonts?utils.watchFont(null,e.target,function(t,e){s()},e.params.wait.timeout):s()}else e.trigger({type:"empty"});return!0},layers.TextLayer.prototype.unload=function(){var t=this;return!(!t.inited||!t.asset)&&(t.asset.tags&&t.asset.tags.initial?t.target.removeChild(t.asset.tags.initial):t.asset.target&&t.target.removeChild(t.asset.target),t.asset.tags=null,t.asset.source=null,t.asset.target=null,t.loaded=!1,t.trigger({type:"unload"}),!0)},layers.VideoLayer=function(t,e,s,i,r,a){this.type="VideoLayer",this.set(t,e,s,i,r,a),this.props={position:null,orientation:null},this.asset={target:null,key:this.key+"_ASSET",tags:null,source:null,resume:null},this.trigger({type:"set"})},layers.VideoLayer.prototype=new layers.AbstractLayer,layers.VideoLayer.prototype.constructor=layers.VideoLayer,layers.VideoLayer.prototype.initProps=function(t){var e=this;return!e.inited&&(e.props.position=new props.PositionProp(utils.isTypeOf(utils.isObject,t.position,{})),e.props.orientation=new props.OrientationProp(utils.isTypeOf(utils.isObject,t.orientation,{})),e.props.orientation.update(e.width(),e.height()),e.props.orientation.enabled&&e.addAttr(e.props.orientation.name,{name:e.props.orientation.name+"_"+e.props.orientation.value}),!0)},layers.VideoLayer.prototype.initParams=function(t){return!this.inited&&(this.params={holder:utils.isTypeOf(utils.isString,t.holder,null),wrapper:utils.isTypeOf(utils.isString,t.wrapper,null),depth:utils.isTypeOf(utils.isNumber,t.depth,-5),tags:utils.isTypeOf(utils.isArray,t.tags,[]),polite:utils.isTypeOf(utils.isBoolean,t.polite,!0),align:utils.isTypeOf(utils.isArray,t.align,["center","middle"]),crop:utils.isTypeOf(utils.isArray,t.crop,[0,0,0,0]),scale:utils.isTypeOf(utils.isString,t.scale,"fill"),ratio:Number(utils.isTypeOf(utils.isNumber,t.ratio,1)),autoplay:utils.isTypeOf(utils.isBoolean,t.autoplay,!1),controls:utils.isTypeOf(utils.isBoolean,t.controls,!1),fullscreen:utils.isTypeOf(utils.isBoolean,t.fullscreen,!1),start:{from:utils.isTypeOf(utils.isNumber,utils.getObjectDeep(t,"start.from"),NaN)},stop:{on:utils.isTypeOf(utils.isNumber,utils.getObjectDeep(t,"stop.on"),NaN)},loop:utils.isTypeOf(utils.isBoolean,t.loop,!0),muted:utils.isTypeOf(utils.isBoolean,t.muted,!0),poster:utils.isTypeOf(utils.isString,t.poster,null),preload:utils.isTypeOf(utils.isString,t.preload,"metadata"),inline:utils.isTypeOf(utils.isBoolean,t.inline,!0),volume:utils.isTypeOf(utils.isNumber,t.volume,.8)},!0)},layers.VideoLayer.prototype.load=function(){var e=this;if(!e.inited||!e.enabled||e.loaded||e.asset.target)return!1;if(0<e.sources.length){function t(){e.inited&&("thumb"===e.params.poster?e.asset.target.poster=utils.getAssetUrl(e.asset.source,"thumb_url"):"preview"===e.params.poster?e.asset.target.poster=utils.getAssetUrl(e.asset.source,"preview_url"):utils.isUrl(e.params.poster)&&(e.asset.target.poster=e.params.poster),e.asset.target.src=utils.getAssetUrl(e.asset.source))}function s(t){if(e.params.fullscreen)e.trigger(t);else try{return t.stopImmediatePropagation(),t.stopPropagation(),t.preventDefault(),!1}catch(t){}}var i=function(t){e.events.load=utils.removeEventSimple(e.asset.target,"loadedmetadata",i),e.loaded=!0,e.available()&&(e.asset.resume?e.asset.target.currentTime=e.asset.resume.time:isNaN(e.params.start.from)||(e.asset.target.currentTime=e.params.start.from),(e.asset.resume&&!1===e.asset.resume.paused||!e.asset.resume&&e.params.autoplay)&&e.play()),e.trigger({type:"load"}),e.asset.target.paused&&e.trigger({type:"pause"}),e.asset.resume=null};e.asset.target=document.createElement("video"),e.asset.tags=utils.wrapElement(e.params.tags),e.asset.target.setAttribute("data-key",e.asset.key),e.asset.tags=utils.wrapElement(e.params.tags),e.asset.tags&&utils.isElement(e.asset.tags.initial)&&utils.isElement(e.asset.tags.latest)?(e.target.appendChild(e.asset.tags.initial),e.asset.tags.latest.appendChild(e.asset.target)):e.target.appendChild(e.asset.target),e.asset.target.preload=e.params.preload,e.asset.target.controls=e.params.controls,e.asset.target.playsinline=e.params.inline,e.params.inline?utils.setAttribute(e.asset.target,"playsinline","true",["webkit-"]):utils.removeAttribute(e.asset.target,"playsinline",["webkit-"]),e.params.inline?utils.setAttribute(e.asset.target,"video-available-inline","",["webkit-"]):utils.removeAttribute(e.asset.target,"video-available-inline",["webkit-"]),e.asset.target.autoplay=!1,e.asset.target.muted=e.asset.resume?e.asset.resume.muted:e.params.muted,e.asset.target.allowfullscreen=e.params.fullscreen,e.asset.target.loop=e.params.loop,e.asset.target.volume=e.asset.resume?e.asset.resume.volume:e.params.volume,e.events.fullscreen=utils.addEventSimple(e.asset.target,"fullscreenchange",s),e.events.fullscreenWebkit=utils.addEventSimple(e.asset.target,"webkitfullscreenchange",s),e.events.fullscreenMoz=utils.addEventSimple(e.asset.target,"mozfullscreenchange",s),e.events.play=utils.addEventSimple(e.asset.target,"play",function(t){e.trigger(t)}),e.events.pause=utils.addEventSimple(e.asset.target,"pause",function(t){e.trigger(t)}),e.events.seeked=utils.addEventSimple(e.asset.target,"seeked",function(t){t.detail={time:e.asset.target.currentTime},e.trigger(t)}),e.events.volume=utils.addEventSimple(e.asset.target,"volumechange",function(t){t.detail={volume:e.asset.target.volume},e.trigger(t),e.asset.target.muted?e.trigger({type:"mute"}):e.asset.target.muted||e.trigger({type:"unmute"})}),e.events.load=utils.addEventSimple(e.asset.target,"loadedmetadata",i),e.props.position.update(e.sources[0].width,e.sources[0].height,e.width(),e.height(),e.params),e.props.position.enabled?(e.asset.source=utils.getAssetSource(e.sources,e.props.position.width*e.params.ratio,e.props.position.height*e.params.ratio),e.addAttr(e.props.position.name,{selector:'[data-key="'+e.asset.key+'"]',css:{position:"absolute",left:e.props.position.left+"px",top:e.props.position.top+"px",width:e.props.position.width+"px",height:e.props.position.height+"px"}})):e.asset.source=utils.getAssetSource(e.sources,e.width()*e.params.ratio,e.height()*e.params.ratio),!0!==e.params.polite||container.isPoliteReady()?t():container.one(container.EVT_ADAPTER_POLITE,function(){t()})}else e.trigger({type:"empty"});return!0},layers.VideoLayer.prototype.unload=function(){var t=this;return t.inited&&t.asset&&(t.loaded&&t.asset.target&&(t.asset.resume={time:t.asset.target.currentTime,paused:t.asset.target.paused,muted:t.asset.target.muted,volume:t.asset.target.volume},t.asset.target.src=""),t.asset.tags&&t.asset.tags.initial?t.target.removeChild(t.asset.tags.initial):t.asset.target&&t.target.removeChild(t.asset.target),t.asset.tags=null,t.asset.source=null,t.asset.target=null,t.loaded=!1,t.trigger({type:"unload"})),!1},layers.VideoLayer.prototype.playable=function(){return!!this.available()&&(!this.asset.resume&&(!this.root||!this.root.stopped))},layers.VideoLayer.prototype.play=function(){return!(!this.loaded||!this.asset.target.paused)&&(this.asset.target.play(),!0)},layers.VideoLayer.prototype.pause=function(){return!(!this.loaded||this.asset.target.paused)&&(this.asset.target.pause(),!0)},layers.VideoLayer.prototype.togglePlay=function(){return!!this.loaded&&(this.asset.target.paused?this.asset.target.play():this.asset.target.pause())},layers.VideoLayer.prototype.stop=function(t){var e=this;return!!e.loaded&&(e.pause(),isNaN(e.params.stop.on)||t||(-1===e.params.stop.on?e.seek(e.asset.target.duration):e.seek(e.params.stop.on)),e.trigger({type:"stop"}),!0)},layers.VideoLayer.prototype.seek=function(t){return!!this.loaded&&(this.asset.target.currentTime=t,!0)},layers.VideoLayer.prototype.mute=function(){return!!this.loaded&&(this.asset.target.muted=!0)},layers.VideoLayer.prototype.unmute=function(){return!!this.loaded&&!(this.asset.target.muted=!1)},layers.VideoLayer.prototype.volume=function(t){return!!this.loaded&&(this.asset.target.volume=t,!0)},layers.VideoLayer.prototype.toggleMute=function(){return!!this.loaded&&(this.asset.target.muted?this.unmute():this.mute())}}(tactic);